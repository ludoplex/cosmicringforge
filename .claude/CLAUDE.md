# CosmicRingForge - LLM Context

## Overview
**Behavior Driven Engineering with Models** — BDE with Models.

Framework for the design and development of any application. All paths lead to C.
All tools compile with cosmocc to APE (Actually Portable Executable).

## Required Reading (in order)
1. **RING_CLASSIFICATION.md** — Tool rings, portability, cosmocc setup
2. **INTEROP_MATRIX.md** — Format relationships (ground truth)
3. **LITERATE.md** — Conventions, traceability

## The Enlightened Principle
```
Directory Structure = Format Graph = Build Rules = Documentation
```

The Makefile discovers formats, not lists files. Conventions derive from format relationships.

## Ring Classification
| Ring | Bootstrap | Examples |
|------|-----------|----------|
| **0** | C + sh + make | schemagen, Lemon, SQLite, Nuklear, yyjson, CLIPS |
| **1** | Ring 0 + C tools | gengetopt, cppcheck, sanitizers |
| **2** | External toolchains | StateSmith, protobuf-c, MATLAB, Rhapsody |

**The Rule:** Ring 2 outputs committed, builds succeed with Ring 0 only.

## Format → Output Mapping
| Source | Generator | Output Pattern |
|--------|-----------|----------------|
| `.schema` | schemagen | `{name}_types.c,h` |
| `.def` | defgen | `{name}_defs.c,h` |
| `.sm` | smgen | `{name}_sm.c,h` |
| `.hsm` | hsmgen | `{name}_hsm.c,h` |
| `.lex` | lexgen | `{name}_lex.c,h` |
| `.grammar` | Lemon | `{name}_parse.c,h` |
| `.feature` | bddgen | `{name}_bdd.c` |
| `.proto` | protoc | `{name}.pb-c.c,h` |
| `.drawio` | StateSmith | `{name}_sm.c,h` |

## Directory Structure
```
specs/{layer}/*.{format}  →  gen/{layer}/*_{role}.c,h
model/*                   →  gen/imported/*
```

Layers: `domain`, `behavior`, `interface`, `parsing`, `testing`

## Commands
```bash
make formats    # Show discovered formats
make regen      # Regenerate all (auto-detect tools)
make verify     # Regen + drift check
make            # Build
make run        # Execute
```

## Universal Workflow
```
Edit spec → make regen → make verify → make → commit
```

Same workflow for ALL formats (native or Ring 2).

## Key Files
| Purpose | Path |
|---------|------|
| Format Matrix | `INTEROP_MATRIX.md` |
| Spec Types | `SPEC_TYPES.md` |
| Literate System | `LITERATE.md` |
| Stacks Reference | `STACKS_REFERENCE.md` |

## Naming Convention
- Files: `{name}_{role}.c` (role from format: `_types`, `_sm`, `_bdd`, etc.)
- Functions: `{Type}_{action}()` (init, validate, step, etc.)
- Generators: `{name}gen.c`

## Generated File Header
```c
/* AUTO-GENERATED by {generator} {version} — DO NOT EDIT
 * @source {spec_file}:{lines}
 * @generated {timestamp}
 * Regenerate: make regen
 */
```

## When Working on This Repo
1. Check `make formats` to see what exists
2. Edit specs in `specs/{layer}/`
3. Run `make regen` then `make verify`
4. All generated code in `gen/` is committed (drift-gated)
