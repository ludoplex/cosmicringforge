/* AUTO-GENERATED by implgen 1.0.0 — DO NOT EDIT
 * @generated Sun Mar  1 15:35:08 2026
 * Regenerate: make regen
 */

#ifndef MEMORY_IMPL_H
#define MEMORY_IMPL_H

/* ── Platform Detection (Cosmopolitan-aware) ────────────────────── */

#ifdef __COSMOPOLITAN__
  #include "libc/runtime/runtime.h"
  #define MEMORY_IS_LINUX    IsLinux()
  #define MEMORY_IS_WINDOWS  IsWindows()
  #define MEMORY_IS_MACOS    IsXnu()
  #define MEMORY_IS_COSMO    1
#else
  #if defined(__linux__)
    #define MEMORY_IS_LINUX    1
    #define MEMORY_IS_WINDOWS  0
    #define MEMORY_IS_MACOS    0
  #elif defined(_WIN32)
    #define MEMORY_IS_LINUX    0
    #define MEMORY_IS_WINDOWS  1
    #define MEMORY_IS_MACOS    0
  #elif defined(__APPLE__)
    #define MEMORY_IS_LINUX    0
    #define MEMORY_IS_WINDOWS  0
    #define MEMORY_IS_MACOS    1
  #endif
  #define MEMORY_IS_COSMO    0
#endif

/* ── Platform Dispatch ────────────────────────────────────────────── */

/* Dispatch for alloc_page */
#if MEMORY_IS_COSMO
  #define MEMORY_ALLOC_PAGE_IMPL() \
      (IsWindows() ? memory_alloc_page_windows() : memory_alloc_page_linux())
#elif MEMORY_IS_LINUX
  #define MEMORY_ALLOC_PAGE_IMPL() memory_alloc_page_linux()
#elif MEMORY_IS_WINDOWS
  #define MEMORY_ALLOC_PAGE_IMPL() memory_alloc_page_windows()
#elif MEMORY_IS_COSMO
  #define MEMORY_ALLOC_PAGE_IMPL() memory_alloc_page_cosmo()
#endif

/* Dispatch for thread_create */
#if MEMORY_IS_COSMO
  #define MEMORY_THREAD_CREATE_IMPL() \
      (IsWindows() ? memory_thread_create_windows() : memory_thread_create_linux())
#elif MEMORY_IS_LINUX
  #define MEMORY_THREAD_CREATE_IMPL() memory_thread_create_linux()
#elif MEMORY_IS_WINDOWS
  #define MEMORY_THREAD_CREATE_IMPL() memory_thread_create_windows()
#endif

/* ── SIMD Dispatch ─────────────────────────────────────────────────── */

typedef enum {
    MEMORY_SIMD_SCALAR = 0,
    MEMORY_SIMD_AVX2,
    MEMORY_SIMD_SSE4,
    MEMORY_SIMD_NEON,
    MEMORY_SIMD_COUNT
} memory_simd_t;

/* Runtime SIMD detection */
static inline memory_simd_t memory_detect_simd(void) {
#if defined(__AVX2__)
    return MEMORY_SIMD_AVX2;
#elif defined(__AVX__)
    return MEMORY_SIMD_AVX;
#elif defined(__SSE4_1__)
    return MEMORY_SIMD_SSE4;
#elif defined(__ARM_NEON)
    return MEMORY_SIMD_NEON;
#else
    return MEMORY_SIMD_SCALAR;
#endif
}

#endif /* MEMORY_IMPL_H */
