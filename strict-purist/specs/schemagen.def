// schemagen.def â€” Self-hosted Schema Generator Types
// X-Macro format: TABLE/FIELD macros for preprocessor expansion
// Documentation is MANDATORY for all tables and fields

TABLE(SchemaField, "A field definition within a schema type")
FIELD(SchemaField, name,        str,  TEXT,    NOTNULL, "Field identifier")
FIELD(SchemaField, base_type,   u8,   INTEGER, NOTNULL, "Base type enum value")
FIELD(SchemaField, struct_name, str,  TEXT,    0,       "Struct name for TYPE_STRUCT")
FIELD(SchemaField, array_size,  i32,  INTEGER, 0,       "Array size (0=not array)")
FIELD(SchemaField, is_pointer,  i32,  INTEGER, 0,       "Is pointer type")
FIELD(SchemaField, has_range,   i32,  INTEGER, 0,       "Has range constraint")
FIELD(SchemaField, range_min,   i64,  INTEGER, 0,       "Minimum value constraint")
FIELD(SchemaField, range_max,   i64,  INTEGER, 0,       "Maximum value constraint")
FIELD(SchemaField, has_default, i32,  INTEGER, 0,       "Has default value")
FIELD(SchemaField, default_val, i64,  INTEGER, 0,       "Default value")
FIELD(SchemaField, not_empty,   i32,  INTEGER, 0,       "String must be non-empty")
TABLE_END(SchemaField)

TABLE(SchemaType, "A type definition containing fields")
FIELD(SchemaType, name,        str, TEXT,    NOTNULL, "Type identifier")
FIELD(SchemaType, field_count, i32, INTEGER, NOTNULL, "Number of fields")
FIELD(SchemaType, has_json,    i32, INTEGER, 0,       "Generate JSON serialization")
TABLE_END(SchemaType)

TABLE(ParseState, "Parser state during schema processing")
FIELD(ParseState, type_count,   i32, INTEGER, NOTNULL, "Number of types parsed")
FIELD(ParseState, current_line, i32, INTEGER, NOTNULL, "Current line number")
FIELD(ParseState, error_code,   i32, INTEGER, 0,       "Error code if failed")
FIELD(ParseState, error_msg,    str, TEXT,    0,       "Error message")
TABLE_END(ParseState)

TABLE(GenConfig, "Generator configuration")
FIELD(GenConfig, input_path,        str, TEXT,    NOTNULL, "Input spec file path")
FIELD(GenConfig, output_dir,        str, TEXT,    NOTNULL, "Output directory")
FIELD(GenConfig, prefix,            str, TEXT,    NOTNULL, "C identifier prefix")
FIELD(GenConfig, generate_json,     i32, INTEGER, 0,       "Generate JSON functions")
FIELD(GenConfig, generate_validate, i32, INTEGER, 0,       "Generate validators")
FIELD(GenConfig, generate_sql,      i32, INTEGER, 0,       "Generate SQL DDL")
TABLE_END(GenConfig)
