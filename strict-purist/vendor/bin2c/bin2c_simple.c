/* bin2c - Public Domain - Binary to C array converter
 * Usage: bin2c input_file output_file array_name
 */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

int main(int argc, char *argv[]) {
    if (argc < 4) {
        fprintf(stderr, "Usage: %s input output array_name\n", argv[0]);
        return 1;
    }
    FILE *in = fopen(argv[1], "rb");
    if (!in) { perror(argv[1]); return 1; }
    FILE *out = fopen(argv[2], "w");
    if (!out) { perror(argv[2]); fclose(in); return 1; }
    
    fprintf(out, "/* Generated by bin2c from %s */\n", argv[1]);
    fprintf(out, "static const unsigned char %s[] = {\n", argv[3]);
    
    int c, col = 0;
    while ((c = fgetc(in)) != EOF) {
        if (col == 0) fprintf(out, "    ");
        fprintf(out, "0x%02x,", c);
        if (++col >= 12) { fprintf(out, "\n"); col = 0; }
    }
    if (col > 0) fprintf(out, "\n");
    fprintf(out, "};\n");
    fprintf(out, "static const unsigned int %s_len = sizeof(%s);\n", argv[3], argv[3]);
    
    fclose(in); fclose(out);
    return 0;
}
